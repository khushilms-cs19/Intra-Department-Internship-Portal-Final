<!DOCTYPE html>
<html>
  <head>
    <title>Admin Login</title>
    <script type="text/javascript">
      function validate() {
        var emailValidate = LoginPage.emailid.value.search(
          /[a-zA-Z].cse@bmsce.ac.in/
        );
        if (emailValidate == -1) {
          alert("Please Enter a valid email id.");
          document.LoginPage.emailid.focus();
          return false;
        }
        var passwordValidate = LoginPage.password.value;
        if (passwordValidate == "") {
          alert("Please enter your password");
          document.LoginPage.password.focus();
          return false;
        }
      }
    </script>
    <style>
      .adminlogin {
        display: flex;
        flex-direction: column;
        align-items: center;
        background-color: #99ccff;
        width: 300px;
        margin: 2rem auto;
        height: 300px;
        padding: 20px;
        border-radius: 20px;
        gap: 0.6rem;
      }
      .textbox {
        border-radius: 20px;
        width: 230px;
        height: 40px;
        padding-left: 20px;
        border: 0px;
      }
      .loginbutton {
        background-color: #3399ff;
        padding: 8px;
        color: black;
        text-align: center;
        border-radius: 18px;
        text-decoration: none;
        display: inline-block;
        margin-top: 20px;
        width: 100px;
      }
      .loginbutton:hover {
        background-color: #0080ff;
      }
      #errorBox{
        color: red;
        text-align: center;
        display: none;
      }
    </style>
    <link rel="stylesheet" href="/JS/navbar.css" />
    <script src="/JS/navbar.js"></script>
  </head>
  <body style="background-color: #cce6ff">
    <div class="top" style="background-color: #3399ff">
      <a href="https://www.bmsce.ac.in/"
        ><img src="/Images/bmscelogo2.png" id="bmslogo"
      /></a>
      <h1 style="text-align: center">B.M.S College of Engineering</h1>
      <h1 style="text-align: center">Admin Login</h1>
    </div>
    <div id="nav-tag"></div>
    <form
      name="LoginPage"
      class="adminlogin"
      action="/admin-login"
      method="POST"
    >
      <img
        src="/Images/userlogo.jpg"
        style="width: 100px; height: 100px;"
      />
      <input
        class="textbox"
        type="text"
        name="emailid"
        id="email"
        placeholder="Name.cse@bmsce.ac.in"
      />
      <input
        class="textbox"
        type="password"
        name="password"
        id="password"
        placeholder="Password"
      />
      <button class="loginbutton" type="button" id="submit" name="submit">Login</button>
      <p id="errorBox"></p>
    </form>
    <script type="text/javascript">
      var email = document.getElementById('email')
      var password = document.getElementById('password')

      var headers = new Headers()
      headers.append('Content-Type', 'application/json')
      console.log("before button add listener");
      document.getElementById("submit").addEventListener('click', (e) => {
        e.preventDefault()
        fetch('http://localhost:3000/admin-login',{
          method: 'POST',
          headers,
          credentials: 'include',
          body: JSON.stringify({
            email: email.value,
            password: password.value
          })
        }).then(async (res) => {
          newRes = await res.json()
          console.log(newRes)
          if(newRes.status){
            window.location = newRes.redirect
          }else{
            var errorValue = document.getElementById('errorBox')
            errorValue.innerHTML = newRes.errors[0].msg
            errorValue.style.display = 'block'
            setTimeout(() => {
              errorValue.style.display = 'none'
            },2000)
          }
          
        }).catch(e => console.log(e))
      })
      console.log("After the button add listener");
    </script>
  </body>
</html>
